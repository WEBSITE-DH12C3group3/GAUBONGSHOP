<div class="p-4">
  <h2 class="text-2xl font-semibold mb-4">Qu·∫£n l√Ω ƒë∆°n h√†ng</h2>

  <!-- ===== LIST ===== -->
  <ng-container *ngIf="!orderId">
    <div class="flex items-center gap-2 mb-3">
      <label>Tr·∫°ng th√°i:</label>
      <select class="border rounded-xl px-3 py-2" [(ngModel)]="statusFilter" (change)="applyFilter()">
        <option value="">(T·∫•t c·∫£)</option>
        <option value="pending">pending</option>
        <option value="processing">processing</option>
        <option value="shipped">shipped</option>
        <option value="delivered">delivered</option>
        <option value="cancelled">cancelled</option>
      </select>
    </div>

    <!-- Lu√¥n render; kh√¥ng d√πng c·ªù loading -->
    <div class="grid gap-3" *ngIf="items.length > 0; else emptyList">
      <div
        *ngFor="let o of items"
        class="p-4 rounded-2xl border shadow bg-white flex items-center justify-between"
      >
        <div>
          <div class="font-semibold">ƒê∆°n #{{ o.id }}</div>
          <div class="text-sm text-gray-500">Ng√†y: {{ o.orderDate | date:'short' }}</div>
          <div class="text-sm">Tr·∫°ng th√°i: <b class="uppercase">{{ o.status }}</b></div>
        </div>

        <div class="flex items-center gap-3">
          <div class="text-xl font-bold">{{ o.totalAmount | currency:'VND':'symbol':'1.0-0' }}</div>
          <!-- üëâ d√πng routerLink tr·ª±c ti·∫øp, tr√°nh c·∫ßn click l·∫ßn 2 -->
          <a
            class="px-3 py-2 rounded-2xl border inline-block"
            [routerLink]="['/admin/orders', o.id]">
            Chi ti·∫øt
          </a>
        </div>
      </div>

      <div class="flex items-center justify-between mt-3">
        <button type="button" class="px-3 py-2 rounded-2xl border" (click)="prevPage()" [disabled]="page<=0">‚Üê Tr∆∞·ªõc</button>
        <div>Trang {{ page + 1 }}</div>
        <button type="button" class="px-3 py-2 rounded-2xl border" (click)="nextPage()">Sau ‚Üí</button>
      </div>
    </div>

    <ng-template #emptyList>
      <div class="text-gray-500">Kh√¥ng c√≥ ƒë∆°n n√†o.</div>
    </ng-template>
  </ng-container>

  <!-- ===== DETAIL ===== -->
  <ng-container *ngIf="orderId">
    <a class="text-blue-600 underline" (click)="backToList()">‚Üê Quay l·∫°i danh s√°ch</a>

    <!-- Lu√¥n render khung; d√πng optional chaining ƒë·ªÉ tr√°nh l·ªói khi detail ch∆∞a c√≥ -->
    <div class="grid md:grid-cols-3 gap-4 mt-3">
      <div class="md:col-span-2 p-4 rounded-2xl border shadow bg-white">
        <div class="font-semibold text-lg">
          ƒê∆°n #{{ detail?.id || '...' }}
        </div>
        <div class="text-sm text-gray-500">Ng√†y: {{ detail?.orderDate | date:'short' }}</div>
        <div class="text-sm">Tr·∫°ng th√°i: <b class="uppercase">{{ detail?.status || '...' }}</b></div>

        <div class="mt-3 border-t pt-3 grid gap-3">
          <div *ngFor="let it of (detail?.items || [])" class="flex items-center gap-3">
            <img [src]="it.imageUrl || '/assets/placeholder.png'" class="w-14 h-14 rounded-xl object-cover">
            <div class="flex-1">
              <div class="font-medium">{{ it.productName || ('SP #' + it.productId) }}</div>
              <div class="text-sm text-gray-500">
                SL: {{ it.quantity }} √ó {{ it.unitPrice | currency:'VND':'symbol':'1.0-0' }}
              </div>
            </div>
            <div class="font-semibold">{{ it.lineTotal | currency:'VND':'symbol':'1.0-0' }}</div>
          </div>
        </div>
      </div>

      <div class="p-4 rounded-2xl border shadow bg-white h-fit">
        <div class="text-gray-500 text-sm">T·ªïng ti·ªÅn</div>
        <div class="text-2xl font-bold">{{ detail?.totalAmount | currency:'VND':'symbol':'1.0-0' }}</div>

        <div class="mt-3 grid gap-2">
          <button type="button" class="px-4 py-2 rounded-2xl border" [disabled]="updating || !detail" (click)="updateStatus('pending')">pending</button>
          <button type="button" class="px-4 py-2 rounded-2xl border" [disabled]="updating || !detail" (click)="updateStatus('processing')">processing</button>
          <button type="button" class="px-4 py-2 rounded-2xl border" [disabled]="updating || !detail" (click)="updateStatus('shipped')">shipped</button>
          <button type="button" class="px-4 py-2 rounded-2xl border" [disabled]="updating || !detail" (click)="updateStatus('delivered')">delivered</button>
          <button type="button" class="px-4 py-2 rounded-2xl border text-red-600" [disabled]="updating || !detail" (click)="updateStatus('cancelled')">cancelled</button>
        </div>
      </div>
    </div>
  </ng-container>
</div>
