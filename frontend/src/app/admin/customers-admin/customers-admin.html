<div class="p-6 bg-gray-50 min-h-screen">
  <!-- Header -->
  <div class="flex items-center justify-between mb-6">
    <h2 class="text-3xl font-extrabold text-pink-600 flex items-center gap-3">
      üë• Qu·∫£n l√Ω Kh√°ch h√†ng
      <span class="text-sm text-gray-500 font-normal hidden md:inline">CRUD ‚Ä¢ T√¨m ki·∫øm ‚Ä¢ L·ªçc ‚Ä¢ Ph√¢n trang ‚Ä¢ Tr·∫°ng th√°i ‚Ä¢ H·∫°ng</span>
    </h2>
    <button (click)="openCreate()" class="btn-primary">
      ‚ûï Th√™m kh√°ch h√†ng
    </button>
  </div>

  <!-- Filter bar -->
  <div class="grid grid-cols-1 md:grid-cols-6 gap-3 mb-4">
    <input [(ngModel)]="q" placeholder="T√¨m theo t√™n / email / ƒëi·ªán tho·∫°i" class="input md:col-span-2" />
    <select [(ngModel)]="status" class="input">
      <option value="">Tr·∫°ng th√°i</option>
      <option *ngFor="let s of statuses" [value]="s">{{s}}</option>
    </select>
    <select [(ngModel)]="tier" class="input">
      <option value="">H·∫°ng</option>
      <option *ngFor="let t of tiers" [value]="t">{{t}}</option>
    </select>
    <input [(ngModel)]="createdFrom" type="date" class="input" />
    <input [(ngModel)]="createdTo" type="date" class="input" />
  </div>

  <div class="flex items-center gap-2 mb-6">
    <button (click)="page=0; load()" class="btn">L·ªçc</button>
    <div class="text-sm text-gray-500">S·∫Øp x·∫øp: <code>{{sort}}</code></div>
  </div>

  <!-- Loading & Error -->
  <div *ngIf="loading" class="flex justify-center items-center py-10">
    <div class="animate-pulse text-gray-500">ƒêang t·∫£i d·ªØ li·ªáu‚Ä¶</div>
  </div>
  <div *ngIf="errorMsg" class="p-3 bg-red-50 text-red-700 rounded mb-4">{{errorMsg}}</div>

  <!-- Table -->
  <div class="overflow-x-auto bg-white rounded-xl shadow-sm ring-1 ring-gray-200">
    <table class="min-w-full text-sm">
      <thead class="bg-gray-50">
        <tr>
          <th class="th">ID</th>
          <th class="th">Username</th>
          <th class="th">Email</th>
          <th class="th">Phone</th>
          <th class="th">Tr·∫°ng th√°i</th>
          <th class="th">H·∫°ng</th>
          <th class="th">ƒêi·ªÉm</th>
          <th class="th">Ng√†y t·∫°o</th>
          <th class="th w-44">Thao t√°c</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let x of data?.content" class="hover:bg-pink-50/40">
          <td class="td">{{x.id}}</td>
          <td class="td font-medium">{{x.username}}</td>
          <td class="td">{{x.email}}</td>
          <td class="td">{{x.phone}}</td>

          <td class="td">
            <span class="badge" [ngClass]="{
              'badge-green': x.status==='ACTIVE',
              'badge-yellow': x.status==='INACTIVE',
              'badge-red': x.status==='BANNED'
            }">{{x.status}}</span>
            <div class="mt-2 flex flex-wrap gap-1">
              <button class="tag" (click)="setStatus(x,'ACTIVE')">K√≠ch ho·∫°t</button>
              <button class="tag" (click)="setStatus(x,'INACTIVE')">Kh√≥a t·∫°m</button>
              <button class="tag" (click)="setStatus(x,'BANNED')">C·∫•m</button>
            </div>
          </td>

          <td class="td">
            <span class="badge" [ngClass]="{
              'badge-bronze': x.tier==='DONG',
              'badge-silver': x.tier==='BAC',
              'badge-gold': x.tier==='VANG',
              'badge-platinum': x.tier==='BACHKIM',
              'badge-diamond': x.tier==='KIMCUONG'
            }">{{x.tier}}</span>
            <div class="mt-2 flex flex-wrap gap-1">
              <button class="tag" (click)="setTier(x,'DONG')">ƒê·ªìng</button>
              <button class="tag" (click)="setTier(x,'BAC')">B·∫°c</button>
              <button class="tag" (click)="setTier(x,'VANG')">V√†ng</button>
              <button class="tag" (click)="setTier(x,'BACHKIM')">B.Kim</button>
              <button class="tag" (click)="setTier(x,'KIMCUONG')">K.C∆∞∆°ng</button>
            </div>
          </td>

          <td class="td">{{x.points}}</td>
          <td class="td">{{ x.createdAt | date:'short' }}</td>

          <td class="td flex gap-2">
            <button class="btn-sm" (click)="openEdit(x)">S·ª≠a</button>
            <button class="btn-sm-danger" (click)="remove(x.id)">X√≥a</button>
          </td>
        </tr>

        <tr *ngIf="!loading && (data?.content?.length ?? 0)===0">
          <td class="td text-center text-gray-500" colspan="9">Kh√¥ng c√≥ d·ªØ li·ªáu.</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="flex items-center justify-between mt-4">
    <div class="text-sm text-gray-500" *ngIf="data">
      T·ªïng: <b>{{data.totalElements}}</b> ‚Äî Trang <b>{{data.number+1}}</b>/<b>{{data.totalPages}}</b>
    </div>
    <div class="flex items-center gap-2" *ngIf="data">
      <button class="btn" (click)="go(0)" [disabled]="data.number===0">¬´</button>
      <button class="btn" (click)="go(data.number-1)" [disabled]="data.number===0">‚Äπ</button>
      <button class="btn" (click)="go(data.number+1)" [disabled]="data.number+1>=data.totalPages">‚Ä∫</button>
      <button class="btn" (click)="go(data.totalPages-1)" [disabled]="data.number+1>=data.totalPages">¬ª</button>
    </div>
  </div>

  <!-- Modal Create/Edit -->
  <div *ngIf="showModal" class="fixed inset-0 bg-black/40 z-50 grid place-items-center p-4">
    <div class="bg-white w-full max-w-2xl rounded-2xl shadow-xl ring-1 ring-gray-200">
      <div class="px-6 py-4 border-b">
        <h3 class="text-lg font-semibold">{{isEdit ? 'C·∫≠p nh·∫≠t' : 'Th√™m m·ªõi'}} kh√°ch h√†ng</h3>
      </div>

      <div class="p-6 grid md:grid-cols-2 gap-3">
        <input class="input" [(ngModel)]="form.username" placeholder="Username" />
        <input class="input" [(ngModel)]="form.password" [type]="isEdit?'text':'password'" placeholder="M·∫≠t kh·∫©u" />
        <input class="input" [(ngModel)]="form.email" placeholder="Email" />
        <input class="input" [(ngModel)]="form.phone" placeholder="ƒêi·ªán tho·∫°i" />
        <input class="input md:col-span-2" [(ngModel)]="form.address" placeholder="ƒê·ªãa ch·ªâ" />

        <select class="input" [(ngModel)]="form.status">
          <option *ngFor="let s of statuses" [value]="s">{{s}}</option>
        </select>
        <select class="input" [(ngModel)]="form.tier">
          <option *ngFor="let t of tiers" [value]="t">{{t}}</option>
        </select>
      </div>

      <div class="px-6 py-4 border-t flex justify-end gap-2">
        <button class="btn" (click)="showModal=false">H·ªßy</button>
        <button class="btn-primary" (click)="save()">L∆∞u</button>
      </div>
    </div>
  </div>
</div>
