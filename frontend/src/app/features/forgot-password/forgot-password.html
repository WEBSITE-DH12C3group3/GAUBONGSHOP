<!-- FORGOT PASSWORD – Pastel Pink UI (Tailwind only, no dark mode) -->
<div class="min-h-[calc(100svh-120px)] bg-[#FFE4EC] flex items-center justify-center p-4">
  <div class="w-full max-w-xl">
    <div class="bg-white rounded-2xl shadow-xl ring-1 ring-pink-200/60 overflow-hidden">

      <!-- Header + progress -->
      <div class="px-6 pt-6">
        <h2 class="text-2xl font-semibold tracking-tight text-pink-700">Quên mật khẩu</h2>
        <p class="text-sm text-pink-700/70 mt-1">
          Nhập email → xác thực mã → đặt lại mật khẩu.
        </p>

        <ol class="mt-4 flex items-center gap-2 text-sm">
          <li class="flex items-center gap-2">
            <span
              class="inline-flex size-6 items-center justify-center rounded-full text-white"
              [ngClass]="step()>=1 ? 'bg-pink-600' : 'bg-pink-200 text-pink-700'">1</span>
            <span class="hidden sm:inline text-pink-700/70">Email</span>
          </li>
          <span class="h-px w-8 bg-pink-200"></span>
          <li class="flex items-center gap-2">
            <span
              class="inline-flex size-6 items-center justify-center rounded-full text-white"
              [ngClass]="step()>=2 ? 'bg-pink-600' : 'bg-pink-200 text-pink-700'">2</span>
            <span class="hidden sm:inline text-pink-700/70">Xác thực</span>
          </li>
          <span class="h-px w-8 bg-pink-200"></span>
          <li class="flex items-center gap-2">
            <span
              class="inline-flex size-6 items-center justify-center rounded-full text-white"
              [ngClass]="step()>=3 ? 'bg-pink-600' : 'bg-pink-200 text-pink-700'">3</span>
            <span class="hidden sm:inline text-pink-700/70">Đổi mật khẩu</span>
          </li>
        </ol>
      </div>

      <!-- Notice -->
      <div *ngIf="notice()" class="px-6 mt-4">
        <div
          class="rounded-xl p-3 text-sm"
          [ngClass]="{
            'bg-emerald-50 text-emerald-800 ring-1 ring-emerald-200': notice()?.type==='success',
            'bg-rose-50 text-rose-800 ring-1 ring-rose-200': notice()?.type==='error',
            'bg-pink-50 text-pink-800 ring-1 ring-pink-200': notice()?.type==='info'
          }">
          {{ notice()?.text }}
        </div>
      </div>

      <!-- Body -->
      <div class="p-6 space-y-6">

        <!-- Step 1: Email -->
        <form *ngIf="step()===1" [formGroup]="emailForm" (ngSubmit)="submitEmail()" class="space-y-4" autocomplete="off" novalidate>
          <label class="block">
            <span class="block text-sm font-medium mb-1 text-pink-800">Email</span>
            <input
              formControlName="email"
              type="email"
              inputmode="email"
              placeholder="you@example.com"
              class="w-full rounded-xl border border-pink-200 bg-white text-pink-900 placeholder-pink-400/80 px-4 py-3 outline-none focus:ring-2 focus:ring-pink-400 focus:border-pink-400"
            />
          </label>

          <button
            type="submit"
            [disabled]="emailForm.invalid || loading()"
            class="w-full inline-flex items-center justify-center gap-2 rounded-xl bg-pink-600 hover:bg-pink-500 text-white py-3 font-medium disabled:opacity-60 disabled:cursor-not-allowed">
            <i class="fa fa-paper-plane"></i>
            {{ loading() ? 'Đang gửi...' : 'Gửi mã xác thực' }}
          </button>

          <div class="text-center text-sm text-pink-700/70">
            <a routerLink="/login" class="hover:underline text-pink-600">Quay lại đăng nhập</a>
          </div>
        </form>

        <!-- Step 2: OTP -->
        <form *ngIf="step()===2" [formGroup]="otpForm" (ngSubmit)="verifyCode()" class="space-y-5">
          <p class="text-sm text-pink-700/80">
            Nhập mã gồm 6 số đã gửi tới <span class="font-medium text-pink-800">{{ emailForm.value['email'] }}</span>.
          </p>

          <!-- OTP inputs -->
          <div class="flex items-center justify-center gap-2 sm:gap-3">
            <ng-container *ngFor="let d of [0,1,2,3,4,5]">
              <input
                [id]="'otp-'+d"
                [formControlName]="'d'+d"
                maxlength="1"
                inputmode="numeric"
                pattern="[0-9]*"
                class="w-12 h-12 sm:w-14 sm:h-14 text-center text-xl sm:text-2xl rounded-xl border border-pink-200 bg-white text-pink-900 outline-none focus:ring-2 focus:ring-pink-400"
                (input)="onDigitInput($event, d)"
                (keydown)="onDigitKeydown($event, d)"
                aria-label="Mã số {{d+1}}"
              />
            </ng-container>
          </div>

          <!-- Countdown + Resend -->
          <div class="flex items-center justify-between text-sm">
            <div class="text-pink-700/80">
              Hết hạn sau: <span class="font-semibold text-pink-900">{{ secondsToMMSS() }}</span>
            </div>
            <button
              type="button"
              (click)="resendCode()"
              [disabled]="loading() || (secondsLeft() > 0 && secondsLeft() < 260)"
              class="inline-flex items-center gap-1 px-3 py-2 rounded-lg border border-pink-200 hover:bg-pink-50 text-pink-800 disabled:opacity-60 disabled:cursor-not-allowed">
              <i class="fa fa-redo"></i> Gửi lại mã
            </button>
          </div>

          <button
            type="submit"
            [disabled]="otpForm.invalid || loading()"
            class="w-full inline-flex items-center justify-center gap-2 rounded-xl bg-pink-600 hover:bg-pink-500 text-white py-3 font-medium disabled:opacity-60 disabled:cursor-not-allowed">
            <i class="fa fa-check"></i>
            {{ loading() ? 'Đang xác thực...' : 'Xác thực mã' }}
          </button>

          <div class="text-center">
            <button type="button" class="text-pink-600 hover:underline text-sm" (click)="step.set(1)">⟵ Sửa email</button>
          </div>
        </form>

        <!-- Step 3: Reset -->
        <form *ngIf="step()===3" [formGroup]="resetForm" (ngSubmit)="submitReset()" class="space-y-5" autocomplete="off">
          <div class="grid gap-4">
            <label class="block">
              <span class="block text-sm font-medium mb-1 text-pink-800">Mật khẩu mới</span>
              <input
                formControlName="newPassword"
                type="password"
                placeholder="••••••••"
                class="w-full rounded-xl border border-pink-200 bg-white text-pink-900 px-4 py-3 outline-none focus:ring-2 focus:ring-pink-400 focus:border-pink-400"
              />
            </label>

            <!-- Strength meter -->
            <div class="h-2 w-full bg-pink-100 rounded-full overflow-hidden">
              <div
                class="h-full transition-all"
                [style.width.%]="(strength(resetForm.value['newPassword'] || '')+1)*20"
                [ngClass]="{
                  'bg-rose-400'  : strength(resetForm.value['newPassword'] || '')<=1,
                  'bg-amber-400' : strength(resetForm.value['newPassword'] || '')===2,
                  'bg-blue-400'  : strength(resetForm.value['newPassword'] || '')===3,
                  'bg-emerald-500' : strength(resetForm.value['newPassword'] || '')>=4
                }">
              </div>
            </div>
            <p class="text-xs text-pink-700/70">
              Gợi ý: tối thiểu 8 ký tự, gồm chữ hoa, chữ thường, số và ký tự đặc biệt.
            </p>

            <label class="block">
              <span class="block text-sm font-medium mb-1 text-pink-800">Xác nhận mật khẩu</span>
              <input
                formControlName="confirmPassword"
                type="password"
                placeholder="••••••••"
                class="w-full rounded-xl border border-pink-200 bg-white text-pink-900 px-4 py-3 outline-none focus:ring-2 focus:ring-pink-400 focus:border-pink-400"
              />
            </label>

            <p *ngIf="resetForm.hasError('notMatch') && resetForm.touched" class="text-xs text-rose-600">
              Mật khẩu không khớp.
            </p>
          </div>

          <button
            type="submit"
            [disabled]="resetForm.invalid || loading()"
            class="w-full inline-flex items-center justify-center gap-2 rounded-xl bg-pink-600 hover:bg-pink-500 text-white py-3 font-medium disabled:opacity-60 disabled:cursor-not-allowed">
            <i class="fa fa-unlock-alt"></i>
            {{ loading() ? 'Đang đổi...' : 'Đổi mật khẩu' }}
          </button>

          <div class="text-center">
            <button type="button" class="text-pink-600 hover:underline text-sm" (click)="step.set(2)">⟵ Quay lại nhập mã</button>
          </div>
        </form>

      </div>
    </div>

    <div class="text-center text-sm text-pink-700/70 mt-4">
      <a routerLink="/login" class="text-pink-600 hover:underline">Đăng nhập</a> ·
      <a routerLink="/register" class="text-pink-600 hover:underline">Đăng ký</a>
    </div>
  </div>
</div>
